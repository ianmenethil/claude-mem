---
title: "Configuration"
description: "Settings and configuration options for Claude-Mem"
---

# Configuration

Claude-mem uses a centralized settings system with four access methods:

1. **Agent Skill** (recommended) - Natural language settings management within Claude Code
2. **Slash Commands** - Quick toggle commands for common operations
3. **CLI Tool** - Cross-platform command-line interface
4. **Direct Edit** - Manually edit `~/.claude-mem/settings.json`

## Settings File

**Location**: `~/.claude-mem/settings.json`

**Priority Order**:
1. Settings file (highest priority)
2. Default values (lowest priority)

## Available Settings

### model
AI model used for processing observations and generating summaries.

**Options**:
- `claude-haiku-4-5` - Fast, cost-efficient
- `claude-sonnet-4-5` - Balanced (default)
- `claude-opus-4` - Most capable
- `claude-3-7-sonnet` - Alternative version

### workerPort
Port for the background worker service HTTP API.

**Range**: 1-65535
**Default**: 37777

### enableMemoryStorage
Enable/disable saving tool observations to the database.

**Options**: true (default), false
**Use case**: Temporarily disable observation storage without uninstalling the plugin

### enableContextInjection
Enable/disable context injection at session start.

**Options**: true (default), false
**Use case**: Disable context loading while keeping observation storage active

### contextDepth
Number of recent sessions to load when injecting context.

**Range**: 1-50
**Default**: 5
**Note**: Higher values = more historical context but more tokens used

## Using the Agent Skill

Ask Claude to manage settings using natural language:

```
"Show me my claude-mem settings"
"Change my model to haiku"
"Disable memory storage"
"Set context depth to 10"
"Turn off context injection"
```

The skill is located at `plugin/skills/claude-mem-settings/SKILL.md` and automatically available when the plugin is installed.

## Using Slash Commands

For quick toggle operations, use these slash commands:

```
/claude-mem:context-on    # Enable context injection
/claude-mem:context-off   # Disable context injection
/claude-mem:memory-on     # Enable memory storage
/claude-mem:memory-off    # Disable memory storage
```

The plugin prefix `/claude-mem:` is optional unless there are name collisions. These commands provide instant on/off control for the most commonly toggled settings.

## Using the CLI Tool

**Location**: `plugin/scripts/settings-cli.js`

**Commands**:
```bash
# View current settings (formatted)
node plugin/scripts/settings-cli.js

# View as JSON
node plugin/scripts/settings-cli.js --json

# Get specific setting
node plugin/scripts/settings-cli.js --get model

# Set a value
node plugin/scripts/settings-cli.js --set model=claude-haiku-4-5
node plugin/scripts/settings-cli.js --set contextDepth=10
node plugin/scripts/settings-cli.js --set enableMemoryStorage=false

# Reset to defaults
node plugin/scripts/settings-cli.js --reset

# Show help
node plugin/scripts/settings-cli.js --help
```

## Direct Edit

You can manually edit the settings file at `~/.claude-mem/settings.json`:

```json
{
  "model": "claude-sonnet-4-5",
  "workerPort": 37777,
  "enableMemoryStorage": true,
  "enableContextInjection": true,
  "contextDepth": 5
}
```

## Applying Changes

- **Model or Port Changes**: Restart the worker service
  ```bash
  pm2 restart claude-mem-worker
  ```

- **Toggle Changes** (enableMemoryStorage, enableContextInjection, contextDepth): Take effect immediately on next hook execution

## Files and Directories

### Data Directory Structure

```
~/.claude-mem/
├── claude-mem.db           # SQLite database
├── settings.json           # Configuration settings
└── logs/
    ├── worker-out.log      # Worker stdout logs
    └── worker-error.log    # Worker stderr logs
```

### Plugin Directory Structure

```
${CLAUDE_PLUGIN_ROOT}/
├── .claude-plugin/
│   └── plugin.json         # Plugin metadata
├── .mcp.json               # MCP server configuration
├── hooks/
│   └── hooks.json          # Hook configuration
├── skills/
│   └── claude-mem-settings/  # Settings management skill
└── scripts/                # Built executables
    ├── context-hook.js
    ├── new-hook.js
    ├── save-hook.js
    ├── summary-hook.js
    ├── cleanup-hook.js
    ├── worker-service.cjs
    ├── search-server.js
    └── settings-cli.js
```

## Plugin Configuration

### Hooks Configuration

Hooks are configured in `plugin/hooks/hooks.json`:

```json
{
  "description": "Claude-mem memory system hooks",
  "hooks": {
    "SessionStart": [{
      "hooks": [{
        "type": "command",
        "command": "cd \"${CLAUDE_PLUGIN_ROOT}/..\" && npm install --prefer-offline --no-audit --no-fund --loglevel=error && node ${CLAUDE_PLUGIN_ROOT}/scripts/context-hook.js",
        "timeout": 120
      }]
    }],
    "UserPromptSubmit": [{
      "hooks": [{
        "type": "command",
        "command": "node ${CLAUDE_PLUGIN_ROOT}/scripts/new-hook.js",
        "timeout": 120
      }]
    }],
    "PostToolUse": [{
      "matcher": "*",
      "hooks": [{
        "type": "command",
        "command": "node ${CLAUDE_PLUGIN_ROOT}/scripts/save-hook.js",
        "timeout": 120
      }]
    }],
    "Stop": [{
      "hooks": [{
        "type": "command",
        "command": "node ${CLAUDE_PLUGIN_ROOT}/scripts/summary-hook.js",
        "timeout": 120
      }]
    }],
    "SessionEnd": [{
      "hooks": [{
        "type": "command",
        "command": "node ${CLAUDE_PLUGIN_ROOT}/scripts/cleanup-hook.js",
        "timeout": 120
      }]
    }]
  }
}
```

### MCP Server Configuration

The MCP search server is configured in `plugin/.mcp.json`:

```json
{
  "mcpServers": {
    "claude-mem-search": {
      "type": "stdio",
      "command": "${CLAUDE_PLUGIN_ROOT}/scripts/search-server.js"
    }
  }
}
```

This registers the `claude-mem-search` server with Claude Code, making the search tools available in all sessions.

## PM2 Configuration

Worker service is managed by PM2 via `ecosystem.config.cjs`:

```javascript
module.exports = {
  apps: [{
    name: 'claude-mem-worker',
    script: './plugin/scripts/worker-service.cjs',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '500M',
    env: {
      NODE_ENV: 'production',
      FORCE_COLOR: '1'
    }
  }]
};
```

### PM2 Settings

- **instances**: 1 (single instance)
- **autorestart**: true (auto-restart on crash)
- **watch**: false (no file watching)
- **max_memory_restart**: 500M (restart if memory exceeds 500MB)

## Advanced Configuration

### Hook Timeouts

Modify timeouts in `plugin/hooks/hooks.json`:

```json
{
  "timeout": 120  // Default: 120 seconds
}
```

Recommended values:
- SessionStart: 120s (needs time for npm install and context retrieval)
- UserPromptSubmit: 60s
- PostToolUse: 120s (can process many observations)
- Stop: 60s
- SessionEnd: 60s

### Worker Memory Limit

Modify PM2 memory limit in `ecosystem.config.cjs`:

```javascript
{
  max_memory_restart: '1G'  // Increase if needed
}
```

## Configuration Best Practices

1. **Use defaults**: Default configuration works for most use cases
2. **Override selectively**: Only change what you need
3. **Document changes**: Keep track of custom configurations
4. **Test after changes**: Verify worker restarts successfully
5. **Monitor logs**: Check worker logs after configuration changes

## Troubleshooting Configuration

### Configuration Not Applied

1. Restart worker after model or port changes:
   ```bash
   pm2 restart claude-mem-worker
   ```

2. Verify settings:
   ```bash
   node plugin/scripts/settings-cli.js
   ```

3. Check worker logs:
   ```bash
   pm2 logs claude-mem-worker
   ```

### Invalid Settings

All settings have built-in validation with helpful error messages. If you specify an invalid value, you'll see a clear error message explaining the valid options.

### Port Already in Use

If port 37777 is already in use:

1. Set custom port:
   ```bash
   node plugin/scripts/settings-cli.js --set workerPort=38000
   ```

2. Restart worker:
   ```bash
   pm2 restart claude-mem-worker
   ```

## Next Steps

- [Architecture Overview](architecture/overview) - Understand the system
- [Troubleshooting](troubleshooting) - Common issues
- [Development](development) - Building from source
